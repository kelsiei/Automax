@model CarCareTracker.Models.Home.HomeDashboardViewModel

@{
    ViewData["Title"] = "Dashboard";
}

<h1>Dashboard</h1>
<p class="text-muted">Overview of your garage, urgent reminders, and quick access to upcoming items.</p>

@if (Model.IsAuthenticated)
{
    <p class="text-muted">
        Signed in as
        <strong>
            @(string.IsNullOrWhiteSpace(Model.UserName) ? "current user" : Model.UserName)
        </strong>
        @if (Model.IsRootUser)
        {
            <span class="badge bg-danger ms-2">Root</span>
        }
        else if (Model.IsAdmin)
        {
            <span class="badge bg-primary ms-2">Admin</span>
        }
        else
        {
            <span class="badge bg-secondary ms-2">User</span>
        }
    </p>
}
else
{
    <p class="text-muted">
        You are not currently signed in. Only public information (such as the Message of the Day) is shown here.
    </p>
}

@if (Model.ShowMotd)
{
    <div class="alert alert-info" role="alert">
        <strong>Message of the Day:</strong>
        <div>@Model.Motd</div>
    </div>
}

<div class="row mb-4">
    <div class="col-md-4 mb-3">
        <div class="card dashboard-metric-card">
            <div class="card-body">
                <h6 class="card-title text-muted">Vehicles</h6>
                <p class="display-6 mb-0">@Model.VehicleCount</p>
            </div>
        </div>
    </div>
    <div class="col-md-4 mb-3">
        <div class="card dashboard-metric-card">
            <div class="card-body">
                <h6 class="card-title text-muted">Vehicles with Urgent Reminders</h6>
                <p class="display-6 mb-0">@Model.VehiclesWithUrgentReminders</p>
            </div>
        </div>
    </div>
    <div class="col-md-4 mb-3">
        <div class="card dashboard-metric-card">
            <div class="card-body">
                <h6 class="card-title text-muted">Open Reminders</h6>
                <p class="display-6 mb-0">@Model.OpenRemindersCount</p>
            </div>
        </div>
    </div>
</div>

@if (Model.UpcomingReminders != null && Model.UpcomingReminders.Any())
{
    <h2>Upcoming Reminders (next 30 days)</h2>

    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th class="text-end">Due Date</th>
                    <th>Vehicle</th>
                    <th>Description</th>
                    <th>Urgency</th>
                    <th>Tags</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
            @foreach (var r in Model.UpcomingReminders)
            {
                <tr>
                    <td class="text-end">@(r.DueDate.HasValue ? r.DueDate.Value.ToShortDateString() : "")</td>
                    <td>@r.Year @r.Make @r.Model (@r.LicensePlate)</td>
                    <td>@r.Description</td>
                    <td>@r.Urgency</td>
                    <td>@r.Tags</td>
                    <td>
                        @if (r.IsCompleted)
                        {
                            <span class="badge bg-success">Completed</span>
                        }
                        else
                        {
                            <span class="badge bg-secondary">Open</span>
                        }
                    </td>
                </tr>
            }
            </tbody>
        </table>
    </div>
}
else
{
    <p class="text-muted">
        No upcoming date-based reminders in the next 30 days.
    </p>
}

<p class="mt-3">
    <a asp-controller="Vehicle" asp-action="Index" class="btn btn-primary">Go to Garage</a>
    <a asp-controller="Report" asp-action="Index" class="btn btn-secondary ms-2">View Reports</a>
</p>
